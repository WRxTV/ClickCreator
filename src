import tkinter as tk
from tkinter import ttk, messagebox
import pyautogui
import threading
import time
import platform
import keyboard

pyautogui.PAUSE = 0
running = False

def start_clicking():
    global running
    if running:
        return

    try:
        clicks = int(entry.get())
    except ValueError:
        messagebox.showerror("Chyba", "Zadej platné číslo kliků")
        return

    cps = speed_slider.get()
    delay = 1 / cps
    running = True

    def clicker():
        start_time = time.perf_counter()
        for i in range(clicks):
            if not running:
                break
            pyautogui.click()
            next_click = start_time + (i + 1) * delay
            # menší sleep, aby to jelo stabilně i při vysokých CPS
            while time.perf_counter() < next_click:
                time.sleep(0.00001)
        stop_clicking()

    threading.Thread(target=clicker, daemon=True).start()

def stop_clicking():
    global running
    running = False

def toggle_clicking():
    if running:
        stop_clicking()
    else:
        start_clicking()

def listen_hotkey():
    keyboard.add_hotkey('F6', toggle_clicking)
    keyboard.wait()

threading.Thread(target=listen_hotkey, daemon=True).start()

# GUI
root = tk.Tk()
root.title("ClickCreator I")

style = ttk.Style()
if platform.system() == "Windows":
    style.theme_use('vista')
else:
    style.theme_use('default')

frame = ttk.Frame(root, padding=20)
frame.pack()

ttk.Label(frame, text="Počet kliků:", font=("Segoe UI", 12)).pack(pady=5)
entry = ttk.Entry(frame, font=("Segoe UI", 12))
entry.pack(pady=5)
entry.insert(0, "10")

ttk.Label(frame, text="Rychlost (CPS):", font=("Segoe UI", 12)).pack(pady=5)
speed_slider = ttk.Scale(frame, from_=1, to=64, orient="horizontal")  # maximum 64 CPS
speed_slider.set(10)
speed_slider.pack(pady=5, fill='x')

ttk.Button(frame, text="Start", command=start_clicking).pack(pady=5, fill='x')
ttk.Button(frame, text="Stop", command=stop_clicking).pack(pady=5, fill='x')
ttk.Label(frame, text="F6 = Start/Stop", font=("Segoe UI", 9, "italic")).pack(pady=(10, 0))

root.mainloop()
